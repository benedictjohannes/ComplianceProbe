{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$defs": {
    "Assertion": {
      "properties": {
        "code": {
          "type": "string",
          "minLength": 3,
          "description": "Unique code for the assertion"
        },
        "title": {
          "type": "string",
          "minLength": 3,
          "description": "Title of the assertion"
        },
        "description": {
          "type": "string",
          "minLength": 3,
          "description": "Detailed description of what is being checked"
        },
        "preCmds": {
          "items": {
            "$ref": "#/$defs/Exec"
          },
          "type": "array",
          "description": "Executions before main commands"
        },
        "cmds": {
          "items": {
            "$ref": "#/$defs/Cmd"
          },
          "type": "array",
          "minItems": 1,
          "description": "Main command units to execute"
        },
        "postCmds": {
          "items": {
            "$ref": "#/$defs/Exec"
          },
          "type": "array",
          "description": "Executions after main commands"
        },
        "minPassingScore": {
          "type": "integer",
          "description": "Minimum score to consider assertion as passed",
          "default": 1
        },
        "passDescription": {
          "type": "string",
          "minLength": 3,
          "description": "Message shown if passed"
        },
        "failDescription": {
          "type": "string",
          "minLength": 3,
          "description": "Message shown if failed"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "code",
        "title",
        "description",
        "cmds",
        "passDescription",
        "failDescription"
      ]
    },
    "Cmd": {
      "properties": {
        "exec": {
          "$ref": "#/$defs/Exec",
          "description": "Execution details"
        },
        "passScore": {
          "type": "integer",
          "description": "Score added if passed",
          "default": 1
        },
        "failScore": {
          "type": "integer",
          "description": "Score added if failed",
          "default": -1
        },
        "stdOutRule": {
          "$ref": "#/$defs/EvaluationRule",
          "description": "Rule for stdout evaluation"
        },
        "stdErrRule": {
          "$ref": "#/$defs/EvaluationRule",
          "description": "Rule for stderr evaluation"
        },
        "exitCodeRules": {
          "items": {
            "$ref": "#/$defs/ExitCodeRule"
          },
          "type": "array",
          "description": "Rules for exit code evaluation"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "exec"
      ]
    },
    "EvaluationRule": {
      "properties": {
        "regex": {
          "type": "string",
          "description": "Regex to match against output"
        },
        "includeStdErr": {
          "type": "boolean",
          "description": "Include stderr in regex evaluation",
          "default": false
        },
        "func": {
          "type": "string",
          "description": "JS function for evaluation"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "Exec": {
      "properties": {
        "shell": {
          "type": "string",
          "description": "Shell to use (bash"
        },
        "script": {
          "type": "string",
          "description": "Script to execute"
        },
        "func": {
          "type": "string",
          "description": "Embedded JS code"
        },
        "gather": {
          "items": {
            "$ref": "#/$defs/GatherSpec"
          },
          "type": "array",
          "description": "Data extraction specs"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "ExitCodeRule": {
      "properties": {
        "min": {
          "type": "integer",
          "description": "Minimum exit code"
        },
        "max": {
          "type": "integer",
          "description": "Maximum exit code"
        },
        "result": {
          "type": "integer",
          "description": "Score result (-1"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "result"
      ]
    },
    "GatherSpec": {
      "properties": {
        "key": {
          "type": "string",
          "description": "Key in context"
        },
        "excludeFromReport": {
          "type": "boolean",
          "description": "Hide from final report"
        },
        "regex": {
          "type": "string",
          "description": "Regex to extract data"
        },
        "includeStdErr": {
          "type": "boolean",
          "description": "Include stderr in extraction",
          "default": false
        },
        "func": {
          "type": "string",
          "description": "JS function for extraction"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "key"
      ]
    },
    "Section": {
      "properties": {
        "title": {
          "type": "string",
          "minLength": 3,
          "description": "Title of the section"
        },
        "description": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "minItems": 1,
          "description": "List of descriptions for the section"
        },
        "assertions": {
          "items": {
            "$ref": "#/$defs/Assertion"
          },
          "type": "array",
          "minItems": 1,
          "description": "List of assertions within this section"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "title",
        "description",
        "assertions"
      ]
    }
  },
  "properties": {
    "title": {
      "type": "string",
      "minLength": 3,
      "description": "Title of the report"
    },
    "sections": {
      "items": {
        "$ref": "#/$defs/Section"
      },
      "type": "array",
      "minItems": 1,
      "description": "List of sections in the report"
    }
  },
  "additionalProperties": false,
  "type": "object",
  "required": [
    "title",
    "sections"
  ]
}
